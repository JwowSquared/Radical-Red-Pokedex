<!DOCTYPE html>
<html>
<head>
  <title>Radical Red Data in JSON</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #options {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Radical Red Data in JSON</h1>
  
  <!-- Checkbox Options for Selecting Data to Include -->
  <div id="options">
    <label><input type="checkbox" id="includeSpecies" checked> Species</label><br>
	<label><input type="checkbox" id="includeStats" checked> Stats</label><br>
    <label><input type="checkbox" id="includeMoves" checked> Moves</label><br>
    <label><input type="checkbox" id="includeAbilities" checked> Abilities</label><br>
    <label><input type="checkbox" id="includeItems" checked>Held Items</label><br>
    <label><input type="checkbox" id="includeAreas" checked> Areas</label><br>
    <label><input type="checkbox" id="includeEggGroups" checked> Egg Groups</label><br>
    <label><input type="checkbox" id="includeEvolutions" checked> Evolutions</label><br>
  </div>

  <button id="generate-button">Generate JSON</button>

  <script>
    let repo = "JwowSquared/Radical-Red-Pokedex";
    let version = "rrdex release 1.2.2";

    async function fetchData() {
      let request = new Request(`https://raw.githubusercontent.com/${repo}/master/data.js`);
      let response = await fetch(request);
      let data = await response.text();
      data = new Function("return " + data + ";")();
      return data;
    }

    function downloadJSON(data, filename) {
      const jsonData = JSON.stringify(data, null, 2);
      const blob = new Blob([jsonData], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.click();
      
      URL.revokeObjectURL(url);
    }

    document.getElementById('generate-button').addEventListener('click', async () => {
      const data = await fetchData();
      const result = {};

      // Capture Species
      if (document.getElementById('includeSpecies').checked) {
        const speciesArray = [];
        const includeAbilities = document.getElementById('includeAbilities').checked;
        const includeMoves = document.getElementById('includeMoves').checked;
        const includeItems = document.getElementById('includeItems').checked;
        const includeAreas = document.getElementById('includeAreas').checked;
        const includeEggGroups = document.getElementById('includeEggGroups').checked;
        const includeEvolutions = document.getElementById('includeEvolutions').checked;

        for (const id in data.species) {
          const species = data.species[id];
          const speciesID = parseInt(id);
          const formattedSpecies = {
            ID: id,
            name: species.name,
            type: []
          };

          // Capture types
          const type1 = data.types[species.type[0]] ? data.types[species.type[0]].name : "Unknown";
          const type2 = species.type[1] !== undefined && data.types[species.type[1]] ? data.types[species.type[1]].name : null;
          formattedSpecies.type = [type1, type2].filter(Boolean);

          // Capture Abilities if selected
          if (includeAbilities && species.abilities) {
            formattedSpecies.abilities = [];
            species.abilities.forEach(abilityPair => {
              abilityPair.toString().split(',').forEach(abilityID => {
                const parsedID = parseInt(abilityID.trim());
                if (parsedID === 0) return;
                const ability = Object.values(data.abilities).find(a => a.ID === parsedID);
                if (ability) {
                  formattedSpecies.abilities.push({
                    ID: ability.ID,
                    name: ability.names[0],
                    description: ability.description
                  });
                }
              });
            });
          }
		  
		  // Capture Stats if selected
          if (includeStats && species.stats) {
            formattedSpecies.stats = {
              HP: species.stats[0],
              Attack: species.stats[1],
              Defense: species.stats[2],
              SpecialAttack: species.stats[3],
              SpecialDefense: species.stats[4],
              Speed: species.stats[5],
              BaseStatTotal: species.stats.reduce((total, stat) => total + stat, 0)
            };
          }

          // Capture Items if selected
          if (includeItems && species.items) {
            formattedSpecies.items = [];
            species.items.forEach(itemID => {
              if (itemID === 0) return;
              const item = Object.values(data.items).find(i => i.ID === itemID);
              if (item) {
                formattedSpecies.items.push({
                  ID: item.ID,
                  name: item.name,
                  description: item.description
                });
              }
            });
          }

          // Capture Moves if selected
          if (includeMoves) {
            formattedSpecies.moves = {
              levelupMoves: [],
              tmMoves: [],
              tutorMoves: [],
              eggMoves: []
            };
            if (species.levelupMoves) {
              species.levelupMoves.forEach(movePair => {
                const moveID = movePair[0];
                const level = movePair[1];
                if (moveID === 0) return;

                const move = Object.values(data.moves).find(m => m.ID === moveID);
                if (move) {
                  const moveType = data.types[move.type] ? data.types[move.type].name : "Unknown";
                  formattedSpecies.moves.levelupMoves.push({
                    ID: move.ID,
                    name: move.name,
                    level: level,
                    type: moveType,
                    power: move.power,
                    accuracy: move.accuracy,
                    description: move.description
                  });
                }
              });
            }
          }

          // Capture Egg Groups if selected
          if (includeEggGroups && species.eggGroup) {
            formattedSpecies.eggGroups = species.eggGroup.map(eggGroupID => ({
              ID: eggGroupID,
              name: data.eggGroups[eggGroupID] || "Unknown"
            }));
          }

          // Capture Evolutions if selected
          if (includeEvolutions && species.evolutions) {
            formattedSpecies.evolutions = species.evolutions.map(evolution => {
              const evoTypeID = evolution[0];
              const condition = data.evolutions[evoTypeID] || "Unknown Condition";
              const evolutionLevelOrItemID = evolution[1];
              const nextSpeciesID = evolution[2];
              const extraCondition = evolution[3];
              
              // Look up the species name for the evolvesTo field
              const nextSpeciesName = data.species[nextSpeciesID]?.name || "Unknown Species";

              return {
                type: condition.replace("${evo[1]}", evolutionLevelOrItemID).replace("${evo[3]}", extraCondition),
                evolvesTo: nextSpeciesName
              };
            });
          }

          speciesArray.push(formattedSpecies);
        }
        result.species = speciesArray;
      }

      // Capture Moves, Abilities, Items, Areas, Egg Groups, Evolutions
      if (document.getElementById('includeMoves').checked) result.moves = data.moves;
      if (document.getElementById('includeAbilities').checked) result.abilities = data.abilities;
      if (document.getElementById('includeItems').checked) result.items = data.items;
      if (document.getElementById('includeAreas').checked) result.areas = data.areas;
      if (document.getElementById('includeEggGroups').checked) {
        result.eggGroups = Object.keys(data.eggGroups).map(id => ({
          ID: parseInt(id),
          name: data.eggGroups[id]
        }));
      }
      if (document.getElementById('includeEvolutions').checked) {
        result.evolutions = Object.keys(data.evolutions).map(id => ({
          ID: parseInt(id),
          description: data.evolutions[id]
        }));
      }

      // Download JSON file with selected options
      downloadJSON(result, "selected_data.json");
    });
  </script>
</body>
</html>
